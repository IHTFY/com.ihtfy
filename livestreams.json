{"slug":"livestreams","title":"livestreams","date":"2022-02-04","excerpt":"TODO","tags":["todo"],"html":"<p>This is somewhat related to my <a href=\"https://blog.ihtfy.com/post/soundcloud-likes/\" rel=\"nofollow noopener noreferrer\" target=\"_blank\">previous post</a> about downloading all of my SoundCloud liked songs. I have another batch file that I use to save livestreams. It doesn’t work for YouTube livestreams and probably not Twitch either. Often news sites or other random sites will work.</p>\n<p>Go to the stream and open your internet browser’s developer tools - in Chrome, <code>ctrl</code> + <code>shift</code> + <code>j</code>. Click the “Network” tab. You can optionally filter to the “Fetch/XHR” traffic as well. Now, refresh the page and click play on the video if necessary. You will hopefully find a file that ends in .m3u8. Common filenames are <code>index.m3u8</code>, <code>playlist.m3u8</code>, or <code>manifest.m3u8</code>. Sometimes the file extension is just .m3u.</p>\n<p>This is a playlist file which contains a list of “links” to the most recent chunks of video from the livestream. Often it will contain 3-5 chunks, and gets updated every few seconds. If you click on the file once, then click on the “Response” or “Preview” tab, you’ll see the contents of the file. For Example:</p>\n<picture class=\"svelte-1gy5t1o\"><source srcset=\"/optimized-images/posts/livestreams/m3u8-snapshot.avif\" type=\"image/avif\">\n\t<source srcset=\"/optimized-images/posts/livestreams/m3u8-snapshot.webp\" type=\"image/webp\">\n\t<img src=\"/optimized-images/posts/livestreams/m3u8-snapshot.png\" alt=\"network\" loading=\"lazy\" decoding=\"async\" class=\"svelte-1gy5t1o\">\n\t\n\t\t<figcaption><!-- HTML_TAG_START -->network<!-- HTML_TAG_END --></figcaption>\n</picture>\n<p>An m3u8 file</p>\n<p>In this case, the individual video chunks are .ts files. Each chunk is 2 seconds long. The path to the files are relative, because they don’t start with “https” or a valid URL. This is fine, but it means we can’t simply download the .m3u8 and use it because these .ts files will not be found. We’ll use a link to this m3u8 file instead.</p>\n<p>Right click on the <code>index.m3u8</code> &gt; Copy &gt; Copy link address. Save this for later.</p>\n<p>We’re going to make a batch file that takes an URL to an m3u8 file and saves a video, but first we’ll need to have <a href=\"https://ffmpeg.org/download.html\" rel=\"nofollow noopener noreferrer\" target=\"_blank\">FFmpeg</a> installed.</p>\n<p>FFmpeg is another command line tool to convert videos and tons of <a href=\"https://ffmpeg.org/about.html\" rel=\"nofollow noopener noreferrer\" target=\"_blank\">other manipulation</a>. It’s free, very powerful, and used in almost every video conversion tool you’ve ever used.</p>\n<p>I’m on Windows, so I downloaded the .exe. I would recommend putting it in your Path again. Instructions for that are at the bottom of my <a href=\"https://blog.ihtfy.com/post/soundcloud-likes/\" rel=\"nofollow noopener noreferrer\" target=\"_blank\">SoundCloud post</a>. Adding the folder with the ffmpeg.exe will allow you to run FFmpeg by typing <code>ffmpeg</code> in the command line. It’s possible the installation will add it to your path anyway, but you may need to restart your computer for it to take effect.</p>\n<p>Next, we’ll make the batch file. Make a new text file and add this inside of it:</p>\n<div class=\"code-block svelte-1w2kx1p\"><div class=\"filename svelte-1w2kx1p\">streamDL.bat</div>\n\t<div class=\"lang svelte-1w2kx1p\">batch</div>\n\t<pre class=\"language-batch\"><!-- HTML_TAG_START --><code class=\"language-batch\"><span class=\"token operator\">@</span><span class=\"token command\"><span class=\"token keyword\">ECHO</span> OFF</span>\n<span class=\"token command\"><span class=\"token keyword\">SET</span> <span class=\"token parameter attr-name\">/p</span> <span class=\"token variable\">url</span><span class=\"token operator\">=</span>Stream Link: </span>\n<span class=\"token command\"><span class=\"token keyword\">SET</span> <span class=\"token parameter attr-name\">/p</span> <span class=\"token variable\">name</span><span class=\"token operator\">=</span>Filename: </span>\n<span class=\"token command\"><span class=\"token keyword\">ECHO</span> saving in downloads</span>\n<span class=\"token command\"><span class=\"token keyword\">START</span> ffmpeg -protocol_whitelist file,http,https,tcp,tls,crypto <span class=\"token parameter attr-name\">-i</span> <span class=\"token string\">\"%URL%\"</span> -codec copy <span class=\"token string\">\"C:\\Users\\Frankie\\Downloads\\%name%.mkv\"</span></span></code><!-- HTML_TAG_END --></pre>\n</div>\n<p>You can change the path on the last line. The <code>%name%</code> is a variable which comes from the prompt in line 3. I’m saving as an <code>mkv</code> file, but you could change this to mp4 or something else; from what I recall, it may be faster to save as an mkv.</p>\n<p>Save that text file as a <code>.bat</code> file, like <code>streamDL.bat</code>. Now if you double-click it, it will as you to paste in the stream link that you copied before. Next add a filename - no file extension needed. Then it runs the ffmpeg command:</p>\n<div class=\"code-block svelte-1w2kx1p\"><div class=\"filename svelte-1w2kx1p\">streamDL.bat</div>\n\t<div class=\"lang svelte-1w2kx1p\">batch</div>\n\t<pre class=\"language-batch\"><!-- HTML_TAG_START --><code class=\"language-batch\"><span class=\"token command\"><span class=\"token keyword\">ffmpeg</span> -protocol_whitelist file,http,https,tcp,tls,crypto <span class=\"token parameter attr-name\">-i</span> <span class=\"token string\">\"%URL%\"</span> -codec copy <span class=\"token string\">\"yourFilename.mkv\"</span></span></code><!-- HTML_TAG_END --></pre>\n</div>\n<p>The important part here is the <code>-protocol_whitelist file,http,https,tcp,tls,crypto</code> argument with lets FFmpeg read the .ts files using https or http.</p>\n<p>FFmpeg will automatically keep checking the m3u8 file and get the new ts files while the stream is running. If you go to the downloaded video file, you can refresh windows explorer and see that the file size is increasing.</p>","css":{"code":"picture.svelte-1gy5t1o.svelte-1gy5t1o{position:relative;width:100%;height:100%}picture.svelte-1gy5t1o img.svelte-1gy5t1o{width:100%;height:100%}\n.code-block.svelte-1w2kx1p.svelte-1w2kx1p{display:block;position:relative;background-color:var(--code-background-color);color:var(--code-text-color);font-family:var(--mono-font);font-size:1rem;line-height:1.33em;border-radius:8px;box-shadow:var(--shadow);padding:30px 15px;margin:30px 0}.code-block.svelte-1w2kx1p pre{overflow-x:auto;scrollbar-color:var(--primary-color) var(--scrollbar-track-color);scrollbar-width:thin;padding-bottom:5px}.code-block.svelte-1w2kx1p pre::-webkit-scrollbar{height:8px}.code-block.svelte-1w2kx1p pre::-webkit-scrollbar-thumb{background:var(--primary-color)}.code-block.svelte-1w2kx1p pre::-webkit-scrollbar-thumb:hover{background:var(--primary-light-color)}.code-block.svelte-1w2kx1p .lang.svelte-1w2kx1p{position:absolute;right:0;top:-15px;background:inherit;border-radius:8px;padding:5px 10px;z-index:2;font-size:0.85em}.code-block.svelte-1w2kx1p .filename.svelte-1w2kx1p{background:inherit;border-top-left-radius:8px;border-top-right-radius:8px;margin-bottom:-2px;padding:5px 10px;position:absolute;left:0px;top:-15px;z-index:1}","map":null},"head":"","readingTime":"4 min read","relatedPosts":[{"slug":"habit","title":"habit","date":"2022-04-02","excerpt":"TODO","tags":["todo"],"html":"<p>I still get reminders from the WordPress app to post everyday. Some days it doesn’t work though.</p>\n<p>I started working on building my website with sveltekit again. It’s at <a href=\"https://site.ihtfy.com\" rel=\"nofollow noopener noreferrer\" target=\"_blank\">site.ihtfy.com</a> for now, but eventually I’ll put it on <a href=\"https://ihtfy.com\" rel=\"nofollow noopener noreferrer\" target=\"_blank\">ihtfy.com</a> and <a href=\"https://frankiemercado.com\" rel=\"nofollow noopener noreferrer\" target=\"_blank\">frankiemercado.com</a> will forward to <a href=\"https://ihtfy.com\" rel=\"nofollow noopener noreferrer\" target=\"_blank\">ihtfy.com</a> I think.</p>","css":{"code":"","map":null},"head":"","readingTime":"1 min read"},{"slug":"again","title":"again","date":"2022-03-31","excerpt":"TODO","tags":["todo"],"html":"<p>I forgot to write again.</p>","css":{"code":"","map":null},"head":"","readingTime":"1 min read"},{"slug":"wombo","title":"wombo","date":"2022-03-31","excerpt":"TODO","tags":["todo"],"html":"<p>I’ve been using <a href=\"https://app.wombo.art/\" rel=\"nofollow noopener noreferrer\" target=\"_blank\">this site</a> to make the thumbnail images for these posts - using the title as the prompt.</p>\n<p>The last two days, I forgot to write until just after midnight. I adjusted the post date to be 11:59pm just to keep the dates consistent, but I failed to adhere to the original goal. I think I will move to the weekly posts, and just update the draft throughout the week. This should mean there are no more totally junk posts like the last two days.</p>\n<p>Once I migrate to my new site - by June 21, 2022 - I may consolidate these last 3 months of daily posts.</p>","css":{"code":"","map":null},"head":"","readingTime":"1 min read"}]}